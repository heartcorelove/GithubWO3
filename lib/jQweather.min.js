(function(e){e.weather=function(t){var n=e.extend({},e.fn.weather.defaults,t);if(t.timeFormat===false)n.noTimeChange=true;if(n.changeFormat){n.clickHandler(n)}n.getLocation(n)};jQuery.fn.weather=function(t){return this.each(function(){var n=e.extend({mapdiv:e(this).attr("id")},t);e.weather(n)})};e.fn.weather.defaults={button:"switch",changeFormat:true,clickHandler:function(t){e("#"+t.mapdiv).hide();e("#"+t.button).click(function(){if(t.europeanValues){t.europeanValues=false;if(!t.noTimeChange){t.timeFormat=false}}else{t.europeanValues=true;if(!t.noTimeChange){t.timeFormat=true}}t.getLocation(t)})},europeanValues:true,getLocation:function(t){e.getJSON(t.locationProvider,function(e){t.handleLocation(t,e)})},getWeather:function(t,n){var r=n.europeanValues;e.getJSON("http://freegeoip.net/json/",function(t){e("#output").text("The results are in for "+t.city+", "+t.region_name+", "+t.country_name)});var i=e(t).find("weather");var s="";var o=e(t).find("current_condition");s="<p class='current'>Current temperature: ";if(r){s+=o.find("temp_C").text()+"&deg;C</p>"}else{s+=o.find("temp_F").text()+"&deg;F</p>"}i.each(function(){var t=e(this).find("date").text();if(n.timeFormat){var i=t.split("-");s+="<p class='weather'><a class='date'>Date: "+i[2]+"-"+i[1]+"-"+i[0]+"</a><br>"}else s+="<p class='weather'><a class='date'>Date: "+t+"</a><br>";if(r){var o=e(this).find("tempMaxC").text();var u=e(this).find("tempMinC").text();s+="Max. temperature: "+o+"&deg;C<br> Min. temperature: "+u+"&#176;C <br>";var a=e(this).find("windspeedKmph").text();s+="Windspeed Kph: "+a}else{var f=e(this).find("tempMaxF").text();var l=e(this).find("tempMinF").text();s+="Max. temperature: "+f+"&deg;F <br>Min. temperature: "+l+"&deg;F<br>";var c=e(this).find("windspeedMiles").text();s+="Windspeed Mph: "+c}var h=e(this).find("weatherIconUrl").text();s+="<br><img src='"+h+"'></p>"});switch(e(i).find("weathercode")){case 116:e("body").addClass("sunny");break;case 119:e("body").addClass("clouds");break;case 112:e("body").addClass("verycloudy");break;case 226:e("body").addClass("rainy");break;default:e("body").addClass("clouds");break}e("#"+n.mapdiv).show();e("#"+n.resultdiv).html(s)},getXML:function(t,n,r){e("#output").text("Waiting for results...");e.ajax({url:"http://howestproxy.appspot.com/proxer?xml=http://api.worldweatheronline.com/free/v1/weather.ashx?q="+n+"%2C+"+t+"&format=xml&num_of_days=5&key=umk9aaumj5fxra4k56evbqf2",dataType:"xml",success:function(e){r.getWeather(e,r)},error:r.showError})},handleLocation:function(t,n){var r,i,s;t.getXML(n.longitude,n.latitude,t);if(t.setMap){r=e.extend({center:new google.maps.LatLng(n.latitude,n.longitude)},t.mapVariables);i=new google.maps.Map(document.getElementById(t.mapdiv),r);if(t.setMarker){s=new google.maps.Marker({position:new google.maps.LatLng(n.latitude,n.longitude)});s.setMap(i)}e(document).ajaxComplete(function(e){google.maps.event.trigger(i,"resize");i.setCenter(s.getPosition())})}},locationProvider:"http://freegeoip.net/json/",mapdiv:"googleMap",mapVariables:{zoom:10},noTimeChange:false,resultdiv:"results",setMap:true,setMarker:true,showError:function(){alert("Couldn't get the weather information. Please try again!")},timeFormat:true}})(jQuery)